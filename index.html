<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>Pizzaria das Fra√ß√µes</title>
  <style>
    :root{
      --bg:#fff8ef;--card:#ffffff;--text:#2b1d0e;--muted:#7a6856;--accent:#ff7a00;--ok:#1f9d55;--bad:#d64545;--line:#f1dfcd;
      --slice-filled:#ffb347;--slice-empty:#ffe3c3;--crust:#d07a2a;--center:#ffd86d;
    }
    *,*::before,*::after{box-sizing:border-box;max-width:100%}
    html,body{width:100%;max-width:100%;overflow-x:hidden}
    body{margin:0;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,sans-serif;background:linear-gradient(180deg,#fff8ef 0%,#ffeeda 100%);color:var(--text)}
    body.match-active.mobile-lock{overflow:hidden;overflow-x:hidden;touch-action:manipulation;height:100dvh}
    .wrap{width:100%;max-width:980px;margin:0 auto;padding:16px;overflow-x:hidden}
    .card{width:100%;background:var(--card);border:1px solid var(--line);border-radius:18px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.06);overflow-x:hidden}
    h1{margin:0 0 6px;font-size:clamp(1.35rem,2vw,1.9rem)}
    .sub{margin:0;color:var(--muted)}
    .intro{display:flex;gap:10px;align-items:center;margin:12px 0 8px;padding:10px;border:1px dashed #efc9a4;border-radius:12px;background:#fff9f2}
    .intro p{margin:0;color:#6c533a;font-size:.95rem}
    .mode-row{display:flex;gap:8px;flex-wrap:wrap;margin:10px 0}
    .mode-btn{background:#fff;border:1px solid #efc9a4}
    .mode-btn.active{background:#2b1d0e;color:#fff;border-color:#2b1d0e}
    .hud{display:grid;grid-template-columns:repeat(6,1fr);gap:8px;margin:10px 0}
    .chip{background:#fff;border:1px solid var(--line);padding:8px;border-radius:10px;text-align:center;font-size:.85rem}
    .chip b{display:block;font-size:1.05rem}
    .progress{height:8px;background:#ffe5cc;border-radius:999px;overflow:hidden;margin:8px 0 10px}
    .bar{height:100%;width:0;background:linear-gradient(90deg,#ff9d3f,#ff7a00)}
    .game{display:grid;grid-template-columns:minmax(0,1fr) minmax(0,1fr);gap:14px;align-items:center;min-height:430px;width:100%}
    .game-panel{min-width:0;width:100%}
    .pizza{width:clamp(190px,46vw,320px);aspect-ratio:1;margin:auto;display:block}
    .prompt-slot{display:flex;flex-direction:column;justify-content:center;min-height:72px;margin-bottom:8px;padding:10px 12px;border:1px solid var(--line);border-radius:12px;background:#fffaf4}
    .ask{font-size:1.05rem;margin:0;font-weight:700;line-height:1.3}
    .opts{display:grid;grid-template-columns:1fr 1fr;gap:8px}
    .opts.quad{grid-template-columns:repeat(2,minmax(0,1fr))}
    .answer-dock{display:flex;flex-direction:column;gap:8px}
    button{padding:11px 12px;min-height:44px;border-radius:12px;border:1px solid #efc9a4;background:#fff;cursor:pointer;font-weight:700}
    .cta{background:var(--accent);color:#fff;border:none}
    .feedback{min-height:26px;font-weight:700;margin:0;line-height:1.35}
    .ok{color:var(--ok)} .bad{color:var(--bad)}
    .build-grid{display:grid;grid-template-columns:repeat(4,minmax(56px,1fr));gap:8px}
    .slice-toggle[aria-pressed="true"]{background:#ffd8ab;border-color:#d07a2a}
    .compact{display:none}
    details.panel{margin-top:10px;border:1px solid var(--line);border-radius:10px;padding:8px;background:#fffefc}
    details.panel summary{cursor:pointer;font-weight:700}
    .reward{font-size:.92rem;color:#6c533a;margin-top:6px}
    .tips{margin-top:10px;color:var(--muted);font-size:.92rem}

    @media (max-width:780px){
      body.match-active .wrap{height:100dvh;padding:8px}
      body.match-active .card{height:calc(100dvh - 16px);display:flex;flex-direction:column;padding:10px}
      body.match-active .mode-row{display:none}
      body.match-active .game{grid-template-columns:minmax(0,1fr);grid-template-rows:minmax(220px,42dvh) minmax(0,1fr);gap:8px;min-height:0;flex:1;overflow:hidden}
      body.match-active .pizza{width:clamp(180px,54vw,230px);align-self:center;justify-self:center}
      body.match-active .game-panel{display:flex;flex-direction:column;min-height:0;overflow:hidden}
      body.match-active .prompt-slot{min-height:86px;padding:10px;margin-bottom:6px}
      body.match-active .answer-dock{margin-top:auto;padding:10px;border:1px solid var(--line);border-radius:12px;background:#fffaf4}
      body.match-active .opts{grid-template-columns:1fr}
      body.match-active .opts.quad{grid-template-columns:repeat(2,minmax(0,1fr))}
      body.match-active .build-grid{grid-template-columns:repeat(2,minmax(0,1fr))}
      body.match-active .hud{display:none}
      body.match-active .compact{display:block}
      body.match-active .intro{display:none}
      body.match-active .tips{display:none}
      .mode-row{gap:6px}
      .mode-btn{padding:9px 10px;font-size:.9rem;flex:1 1 150px}
      .hud{grid-template-columns:repeat(3,minmax(0,1fr))}
      .chip{font-size:.8rem;padding:7px}
      .opts{grid-template-columns:1fr}
      .build-grid{grid-template-columns:repeat(3,minmax(52px,1fr))}
    }

    @media (max-width:480px){
      .wrap{padding:10px}
      .card{padding:12px}
      .game{grid-template-columns:minmax(0,1fr);gap:10px;align-items:start;min-height:0}
      body.match-active .game{grid-template-rows:minmax(210px,40dvh) minmax(0,1fr)}
      .game-panel{display:flex;flex-direction:column;gap:8px}
      .pizza{width:clamp(170px,62vw,250px)}
      .prompt-slot{min-height:84px}
      .ask{font-size:1rem}
      .intro p{font-size:.86rem}
    }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <h1>üçï Pizzaria das Fra√ß√µes</h1>
      <p class="sub">Treine fra√ß√µes com modos r√°pidos e visuais.</p>

      <div class="mode-row" id="modeRow">
        <button class="mode-btn active" data-mode="A">Modo A ¬∑ Descobrir</button>
        <button class="mode-btn" data-mode="B">Modo B ¬∑ Constru√ß√£o</button>
        <button class="mode-btn" data-mode="C">Modo C ¬∑ Equivalentes</button>
      </div>

      <div class="intro">
        <button class="cta" id="start">Come√ßar partida</button>
        <p>8 rodadas, 60s no total. No celular, a partida trava rolagem para foco total.</p>
      </div>

      <div class="hud">
        <div class="chip">Rodada <b id="round">1/8</b></div>
        <div class="chip">Pontos <b id="score">0</b></div>
        <div class="chip">Combo <b id="combo">0üî•</b></div>
        <div class="chip">Tempo <b id="time">60s</b></div>
        <div class="chip">XP <b id="xp">0</b></div>
        <div class="chip">Tema <b id="theme">Cl√°ssica</b></div>
      </div>
      <div class="compact">
        <details class="panel">
          <summary>Painel da partida</summary>
          <p><b id="cRound">1/8</b> ¬∑ <b id="cScore">0 pts</b> ¬∑ <b id="cTime">60s</b> ¬∑ XP <b id="cXp">0</b></p>
        </details>
      </div>

      <div class="progress"><div class="bar" id="bar"></div></div>

      <div class="game">
        <svg class="pizza" viewBox="0 0 200 200" id="pizza"></svg>
        <div class="game-panel">
          <div class="prompt-slot" id="promptSlot" aria-live="polite">
            <div class="ask" id="ask">Escolha um modo e clique em <b>Come√ßar partida</b>.</div>
            <p id="feedback" class="feedback" style="display:none"></p>
          </div>
          <div class="answer-dock" id="answerDock">
            <div class="opts" id="opts"></div>
            <div class="build-grid" id="buildGrid" style="display:none"></div>
            <button class="cta" id="checkBuild" style="display:none">Conferir montagem</button>
            <button class="cta" id="next" style="display:none">Pr√≥xima rodada</button>
            <button class="cta" id="restart" style="display:none">Jogar de novo</button>
          </div>
          <p class="reward" id="reward"></p>
          <p class="tips">Dica r√°pida: compare o tamanho das fatias.</p>
        </div>
      </div>
    </section>
  </main>

<script>
const sets=[2,3,4,6,8];
const modes={A:'Descobrir',B:'Constru√ß√£o',C:'Equivalentes'};
const cosmetics=[
  {id:'classic',name:'Cl√°ssica',xp:0,vars:{'--slice-filled':'#ffb347','--slice-empty':'#ffe3c3','--center':'#ffd86d'}},
  {id:'margarita',name:'Margarita',xp:80,vars:{'--slice-filled':'#ff8f7a','--slice-empty':'#ffd8c9','--center':'#f5d469'}},
  {id:'menta',name:'Tema Menta',xp:170,vars:{'--slice-filled':'#8dddb7','--slice-empty':'#d9f7ea','--center':'#f0d96a'}},
  {id:'noturna',name:'Forno Noturno',xp:300,vars:{'--slice-filled':'#8f9bff','--slice-empty':'#dcdfff','--center':'#ffd77a'}}
];

let state={
  mode:'A',round:1,maxRounds:8,score:0,combo:0,time:60,over:false,playing:false,questionActive:false,
  answer:null,current:null,xp:0,unlocked:['classic'],theme:'classic'
};
let timer;
const el=id=>document.getElementById(id);
const isMobile=()=>window.matchMedia('(max-width:780px)').matches;

function showPrompt(text, asHtml=false){
  const ask=el('ask');
  if(asHtml) ask.innerHTML=text; else ask.textContent=text;
  ask.style.display='block';
  const fb=el('feedback');
  fb.style.display='none';
  fb.textContent='';
  fb.className='feedback';
}

function showFeedback(message, isCorrect){
  const ask=el('ask');
  ask.style.display='none';
  const fb=el('feedback');
  fb.style.display='block';
  fb.textContent=message;
  fb.className=`feedback ${isCorrect?'ok':'bad'}`;
}

function gcd(a,b){while(b)[a,b]=[b,a%b];return a}
function simplify(n,d){const g=gcd(n,d);return `${n/g}/${d/g}`}

function applyTheme(id){
  const t=cosmetics.find(c=>c.id===id) || cosmetics[0];
  Object.entries(t.vars).forEach(([k,v])=>document.documentElement.style.setProperty(k,v));
  el('theme').textContent=t.name;
}

function drawPizza(total,filled,selected=[]){
  const svg=el('pizza'); svg.innerHTML='';
  const cx=100,cy=100,r=85;
  for(let i=0;i<total;i++){
    const a1=(i/total)*Math.PI*2-Math.PI/2, a2=((i+1)/total)*Math.PI*2-Math.PI/2;
    const x1=cx+r*Math.cos(a1), y1=cy+r*Math.sin(a1), x2=cx+r*Math.cos(a2), y2=cy+r*Math.sin(a2);
    const large=(a2-a1)>Math.PI?1:0;
    const active = selected.length ? selected.includes(i) : i<filled;
    const color=active?'var(--slice-filled)':'var(--slice-empty)';
    const path=document.createElementNS('http://www.w3.org/2000/svg','path');
    path.setAttribute('d',`M ${cx} ${cy} L ${x1} ${y1} A ${r} ${r} 0 ${large} 1 ${x2} ${y2} Z`);
    path.setAttribute('fill',color); path.setAttribute('stroke','var(--crust)'); path.setAttribute('stroke-width','1.2');
    svg.appendChild(path);
  }
  const c=document.createElementNS('http://www.w3.org/2000/svg','circle');
  c.setAttribute('cx',cx);c.setAttribute('cy',cy);c.setAttribute('r',18);c.setAttribute('fill','var(--center)');c.setAttribute('stroke','var(--crust)');
  svg.appendChild(c);
}

function setMobileLock(on){
  document.body.classList.toggle('match-active',on);
  document.body.classList.toggle('mobile-lock',on && isMobile());
}
window.addEventListener('resize',()=>setMobileLock(state.playing && !state.over));

function updateHud(){
  el('round').textContent=`${Math.min(state.round,state.maxRounds)}/${state.maxRounds}`;
  el('score').textContent=state.score;
  el('combo').textContent=`${state.combo}üî•`;
  el('time').textContent=`${state.time}s`;
  el('xp').textContent=state.xp;
  el('cRound').textContent=el('round').textContent;
  el('cScore').textContent=`${state.score} pts`;
  el('cTime').textContent=`${state.time}s`;
  el('cXp').textContent=state.xp;
  const done=((Math.min(state.round-1,state.maxRounds))/state.maxRounds)*100;
  el('bar').style.width=`${done}%`;
}

function renderModeButtons(){
  [...document.querySelectorAll('.mode-btn')].forEach(b=>b.classList.toggle('active',b.dataset.mode===state.mode));
}

function randomFraction(){
  const d=sets[Math.floor(Math.random()*sets.length)];
  const n=Math.floor(Math.random()*(d-1))+1;
  return {n,d,s:simplify(n,d)};
}

function setOptionLayout(count){
  el('opts').classList.toggle('quad',count===4);
}

function startRoundA(){
  const f=randomFraction();
  state.answer=f.s; state.current=f;
  drawPizza(f.d,f.n);
  showPrompt('Qual fra√ß√£o da pizza est√° destacada?');

  const options=new Set([state.answer]);
  while(options.size<4){ const o=randomFraction(); options.add(o.s); }
  const arr=[...options].sort(()=>Math.random()-0.5);
  el('opts').innerHTML='';
  setOptionLayout(arr.length);
  arr.forEach(v=>{
    const b=document.createElement('button'); b.textContent=v;
    b.onclick=()=>answerChoice(v);
    el('opts').appendChild(b);
  });
}

function startRoundB(){
  const f=randomFraction();
  state.current={...f,selected:[]};
  state.answer=f.s;
  drawPizza(f.d,0,[]);
  showPrompt(`Monte esta fra√ß√£o na pizza: <b>${f.n}/${f.d}</b>`, true);
  setOptionLayout(0);
  el('buildGrid').style.display='grid';
  el('checkBuild').style.display='inline-block';
  el('buildGrid').innerHTML='';
  for(let i=0;i<f.d;i++){
    const bt=document.createElement('button');
    bt.className='slice-toggle'; bt.textContent=`Fatia ${i+1}`; bt.setAttribute('aria-pressed','false');
    bt.onclick=()=>{
      const idx=state.current.selected.indexOf(i);
      if(idx>=0) state.current.selected.splice(idx,1); else state.current.selected.push(i);
      bt.setAttribute('aria-pressed', state.current.selected.includes(i)?'true':'false');
      drawPizza(f.d,0,state.current.selected);
    };
    el('buildGrid').appendChild(bt);
  }
}

function equivalentOptions(n,d){
  const target=simplify(n,d);
  const out=new Set([target]);
  const multipliers=[2,3,4];
  multipliers.forEach(m=>{ if(d*m<=16) out.add(`${n*m}/${d*m}`); });
  while(out.size<4){ const fake=randomFraction(); if(simplify(fake.n,fake.d)!==target) out.add(`${fake.n}/${fake.d}`); }
  return [...out].slice(0,4).sort(()=>Math.random()-0.5);
}

function startRoundC(){
  const f=randomFraction();
  state.current=f;
  drawPizza(f.d,f.n);
  showPrompt('Escolha a fra√ß√£o equivalente √† pizza exibida:');
  const opts=equivalentOptions(f.n,f.d);
  state.answer=simplify(f.n,f.d);
  el('opts').innerHTML='';
  setOptionLayout(opts.length);
  opts.forEach(fr=>{
    const b=document.createElement('button'); b.textContent=fr;
    b.onclick=()=>answerChoice(simplify(...fr.split('/').map(Number)));
    el('opts').appendChild(b);
  });
}

function hideRoundUi(){
  el('opts').innerHTML='';
  setOptionLayout(0);
  el('buildGrid').style.display='none';
  el('buildGrid').innerHTML='';
  el('checkBuild').style.display='none';
}

function newRound(){
  if(state.round>state.maxRounds){endGame();return}
  state.questionActive=true;
  el('next').style.display='none';
  hideRoundUi();
  if(state.mode==='A') startRoundA();
  if(state.mode==='B') startRoundB();
  if(state.mode==='C') startRoundC();
  updateHud();
}

function feedbackExplanation(){
  if(!state.current) return '';
  if(state.mode==='A') return `A pizza destacada representa ${state.current.n}/${state.current.d}.`;
  if(state.mode==='B') return `A montagem correta era selecionar ${state.current.n} de ${state.current.d} fatias.`;
  return `A forma simplificada correta √© ${simplify(state.current.n,state.current.d)}.`;
}

function reward(correct){
  const explanation=feedbackExplanation();
  if(correct){
    state.combo++;
    const gain=10+Math.min(state.combo*2,10);
    const xpGain=12+Math.min(state.combo,8);
    state.score+=gain;
    state.xp+=xpGain;
    showFeedback(`‚úÖ Correto! +${gain} pontos ¬∑ +${xpGain} XP. ${explanation}`, true);
    const newly=cosmetics.find(c=>!state.unlocked.includes(c.id) && state.xp>=c.xp);
    if(newly){
      state.unlocked.push(newly.id);
      state.theme=newly.id;
      applyTheme(newly.id);
      el('reward').textContent=`üéâ Novo cosm√©tico desbloqueado: ${newly.name}`;
    } else el('reward').textContent='';
  } else {
    state.combo=0;
    state.score=Math.max(0,state.score-4);
    showFeedback(`‚ùå Incorreto. ${explanation}`, false);
    el('reward').textContent='';
  }
}

function answerChoice(v){
  if(!state.questionActive) return;
  state.questionActive=false;
  [...el('opts').children].forEach(b=>b.disabled=true);
  reward(v===state.answer);
  state.round++; updateHud();
  if(state.round<=state.maxRounds) el('next').style.display='inline-block'; else endGame();
}

function checkBuild(){
  if(!state.questionActive||state.mode!=='B') return;
  state.questionActive=false;
  const correct = state.current.selected.length===state.current.n;
  [...el('buildGrid').children].forEach(b=>b.disabled=true);
  reward(correct);
  state.round++; updateHud();
  if(state.round<=state.maxRounds) el('next').style.display='inline-block'; else endGame();
}

function startTimer(){
  clearInterval(timer);
  timer=setInterval(()=>{
    if(state.over||!state.playing||!state.questionActive)return;
    state.time--; updateHud();
    if(state.time<=0){state.over=true; endGame(true)}
  },1000);
}

function endGame(timeout=false){
  state.over=true; state.questionActive=false; clearInterval(timer); hideRoundUi();
  drawPizza(8,0);
  setMobileLock(false);
  const msg=timeout?'‚è∞ Tempo esgotado!':'üèÅ Fim do expediente!';
  showPrompt(`${msg} Pontua√ß√£o final: ${state.score} ¬∑ XP: ${state.xp}`);
  showFeedback(state.score>=70?'‚≠ê Mandou muito!':'Boa partida! Bora tentar mais uma?', true);
  el('next').style.display='none';
  el('restart').style.display='inline-block';
}

function resetGame(){
  state={...state,round:1,maxRounds:8,score:0,combo:0,time:60,over:false,answer:null,playing:true,questionActive:false};
  el('reward').textContent='';
  el('restart').style.display='none';
  el('start').style.display='none';
  setMobileLock(true);
  updateHud();
  startTimer();
  newRound();
}

el('start').onclick=resetGame;
el('next').onclick=()=>newRound();
el('restart').onclick=resetGame;
el('checkBuild').onclick=checkBuild;
document.querySelectorAll('.mode-btn').forEach(btn=>btn.onclick=()=>{if(state.playing&&!state.over) return; state.mode=btn.dataset.mode; renderModeButtons();});

applyTheme(state.theme);
renderModeButtons();
drawPizza(4,2);
updateHud();
</script>
</body>
</html>